"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[9508],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>b});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=o.createContext({}),l=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=l(e.components);return o.createElement(s.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),u=l(n),d=a,b=u["".concat(s,".").concat(d)]||u[d]||m[d]||r;return n?o.createElement(b,i(i({ref:t},p),{},{components:n})):o.createElement(b,i({ref:t},p))}));function b(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=d;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c[u]="string"==typeof e?e:a,i[1]=c;for(var l=2;l<r;l++)i[l]=n[l];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},30906:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>l,default:()=>g,frontMatter:()=>s,metadata:()=>p,toc:()=>m});var o=n(87462),a=n(63366),r=n(67294),i=n(3905),c=["components"],s={title:"Step 6: Make your parcel",description:"tutorial step to create your custom micro-lc parcel",sidebar_label:"Step 6: Make your parcel",sidebar_position:60},l=void 0,p={unversionedId:"docs/compose-your-frontend/make-your-parcel",id:"docs/compose-your-frontend/make-your-parcel",title:"Step 6: Make your parcel",description:"tutorial step to create your custom micro-lc parcel",source:"@site/docs/docs/compose-your-frontend/06-make-your-parcel.md",sourceDirName:"docs/compose-your-frontend",slug:"/docs/compose-your-frontend/make-your-parcel",permalink:"/docs/compose-your-frontend/make-your-parcel",draft:!1,editUrl:"https://github.com/micro-lc/documentation/edit/main/docs/docs/compose-your-frontend/06-make-your-parcel.md",tags:[],version:"current",lastUpdatedBy:"Edoardo Pessina",sidebarPosition:60,frontMatter:{title:"Step 6: Make your parcel",description:"tutorial step to create your custom micro-lc parcel",sidebar_label:"Step 6: Make your parcel",sidebar_position:60},sidebar:"docs",previous:{title:"Step 5: Routing",permalink:"/docs/compose-your-frontend/routing"},next:{title:"Step 7: Cross Communication",permalink:"/docs/compose-your-frontend/communication"}},u={},m=[],d={toc:m},b="wrapper";function g(e){var t=e.components,n=(0,a.Z)(e,c);return(0,i.kt)(b,(0,o.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"We briefly touched on webcomponents. Let's dive in custom parcel creation."),(0,i.kt)("p",null,"Almost any JavaScript script can be a parcel, or any HTML page which includes a JavaScript script."),(0,i.kt)("p",null,"You can think of a parcel as an ",(0,i.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Glossary/IIFE"},"IIFE")," (immediately invoked function expression)."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript",metastring:"title=main.js",title:"main.js"},"(() => {\n  // application\n})()\n")),(0,i.kt)("p",null,"Every frontend framework enters the page with an IIFE, maybe packed as a ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/umdjs/umd"},"UMD")," (i.e., ",(0,i.kt)("a",{parentName:"p",href:"https://react.dev"},"React"),") or an ES module (e.g., ",(0,i.kt)("a",{parentName:"p",href:"https://vuejs.org"},"Vue"),")."),(0,i.kt)("p",null,"A React application looks like:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"var ReactDOM /* = defined here */\nvar React /* = defined here */\n(() => {\n  const container = document.getElementById('root')\n  const root = ReactDOM.client.createRoot(container)\n\n  root.render(React.createElement('div', {}, 'Hello!'))\n})()\n")),(0,i.kt)("p",null,"To be included in ",(0,i.kt)("micro-lc",null)," the requirement is to be a valid ",(0,i.kt)("a",{parentName:"p",href:"https://qiankun.umijs.org"},"qiankun plugin")," which in\nreturn is a valid ",(0,i.kt)("a",{parentName:"p",href:"https://single-spa.js.org/docs/parcels-overview"},"single-spa parcel")," bundled as ",(0,i.kt)("strong",{parentName:"p"},"UMD script"),"."),(0,i.kt)("p",null,"Your parcel must export 3 methods:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"interface Parcel {\n  async bootstrap(): null\n  async mount(): null\n  async unmount(): null\n}\n")),(0,i.kt)("p",null,"Since outside an ES module there's no unique way of knowing exports, UMD is recommended as bundle output. ",(0,i.kt)("micro-lc",null)," via qiankun\nwill look for exports via a proxy window property getter"),(0,i.kt)("p",null,"Let's embed a button in the parcel and create the relevant exports:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript",metastring:"title=main.js",title:"main.js"},"(() => {\n  // \ud83e\uddf1 mount application here\n  let container = null\n\n  // define the 'exports' object\n  const exports = {}\n  window['custom-parcel'] = exports\n\n  // define the parcel lifecycle\n  // \ud83d\udc47 bootstrap\n  const bootstrap = async () => null\n  \n  // \ud83d\udc47 mount: called when route is activated\n  const mount = async (props) => {\n    container = props.container\n\n    const div = window.document.createElement('div')\n    const button = window.document.createElement('button')\n    Object.assign(\n      div.style,\n      {\n        alignItems: 'center',\n        display: 'flex',\n        flexDirection: 'column',\n        height: '100%',\n        justifyContent: 'center',\n        textAlign: 'center',\n      }\n    )\n    button.textContent = 'Click Me!'\n    div.appendChild(button)\n    props.container.appendChild(div)\n\n    return null\n  }\n  \n  // \ud83d\udc47 unmount: called when another route is activated\n  const unmount = async () => {\n    if (container !== null) {\n      container.childNodes.forEach((element) => element.remove())\n    }\n\n    return (container = null)\n  }\n\n  exports.bootstrap = bootstrap\n  exports.mount = mount\n  exports.unmount = unmount\n})()\n")),(0,i.kt)("p",null,"Let's use the same ",(0,i.kt)("inlineCode",{parentName:"p"},"data protocol")," technique used in ",(0,i.kt)("a",{parentName:"p",href:"/docs/compose-your-frontend/compose-less-by-reusing#webcomponents"},"step 2")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'echo "data:text/javascript;base64,$(base64 -w 0 main.js)"\n')),(0,i.kt)("p",null,"and then we have some base64 that can be fetched by ",(0,i.kt)("micro-lc",null),". Let's add a new application"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  ...,\n  "applications": {\n    ...,\n    "custom": {\n      "integrationMode": "parcel",\n      "route": "/custom",\n      "entry": {\n        "scripts": [\n          "\ud83d\udcc4 paste base64 code here"\n        ]\n      }\n    }\n  }\n}\n')),(0,i.kt)("p",null,"and also let's reference the application in the menu"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "layout": {\n    "content": {\n      "tag": "bk-layout",\n      "properties": {\n        ...,\n        "menuItems": [\n          ...,\n          {\n            "icon": {\n              "library": "@fortawesome/free-solid-svg-icons",\n              "selector": "faBox"\n            },\n            "id": "custom",\n            "label": "Custom",\n            "type": "application"\n          }\n        ]\n      }\n    },\n    "sources": [\n      ...\n    ]\n  }\n}\n')),(0,i.kt)(r.Fragment,null),(0,i.kt)("tutorial-frame",{configuration:{version:2,applications:{home:{integrationMode:"compose",route:"/",config:{content:{tag:"div",attributes:{style:"height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; row-gap: 24px; font-family: Arial;"},content:[{tag:"img",attributes:{alt:"logo",src:"https://cdn.mia-platform.eu/micro-lc/orchestrator/2.2.0/dist/favicon.png"}},{tag:"bk-button",properties:{content:"Go to official documentation",action:{type:"href",config:{href:"https://micro-lc.io/",target:"_blank"}}}}]},sources:["https://cdn.jsdelivr.net/npm/@micro-lc/bk-web-components/dist/bk-web-components.esm.js"]}},about:{integrationMode:"iframe",route:"/about",src:"https://example.com/"},hash:{integrationMode:"parcel",route:"/hash/",entry:"https://cdn.mia-platform.eu/micro-lc/examples/0.1.3/static/parcels/react-hash-router/index.html"},browser:{integrationMode:"parcel",route:"/browser/",injectBase:!0,entry:"https://cdn.mia-platform.eu/micro-lc/examples/0.1.3/static/parcels/react-browser-router/index.html"},angular:{integrationMode:"parcel",route:"/angular/",injectBase:"override",entry:"https://cdn.mia-platform.eu/micro-lc/examples/0.1.3/static/parcels/angular13/index.html"},custom:{integrationMode:"parcel",route:"/custom",entry:{scripts:["data:text/javascript;base64,InVzZSBzdHJpY3QiOygoKT0+e2xldCB0PW51bGw7Y29uc3QgZT17fTt3aW5kb3dbImN1c3RvbS1wYXJjZWwiXT1lO2NvbnN0IGw9YXN5bmMoKT0+bnVsbCxpPWFzeW5jIG49Pnt0PW4uY29udGFpbmVyLGNvbnNvbGUubG9nKG4ubWljcm9sY0FwaSk7Y29uc3Qgbz13aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksYz13aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7cmV0dXJuIE9iamVjdC5hc3NpZ24oby5zdHlsZSx7YWxpZ25JdGVtczoiY2VudGVyIixkaXNwbGF5OiJmbGV4IixmbGV4RGlyZWN0aW9uOiJjb2x1bW4iLGhlaWdodDoiMTAwJSIsanVzdGlmeUNvbnRlbnQ6ImNlbnRlciIsdGV4dEFsaWduOiJjZW50ZXIifSksYy50ZXh0Q29udGVudD0iQ2xpY2sgTWUhIixvLmFwcGVuZENoaWxkKGMpLG4uY29udGFpbmVyLmFwcGVuZENoaWxkKG8pLG51bGx9LHU9YXN5bmMoKT0+KHQhPT1udWxsJiZ0LmNoaWxkTm9kZXMuZm9yRWFjaChuPT5uLnJlbW92ZSgpKSx0PW51bGwpO2UuYm9vdHN0cmFwPWwsZS5tb3VudD1pLGUudW5tb3VudD11fSkoKTsK"]}}},layout:{content:{tag:"bk-layout",properties:{logo:{url:"https://avatars.githubusercontent.com/u/92730708?s=200&v=4"},menuItems:[{icon:{library:"@ant-design/icons-svg",selector:"HomeOutlined"},id:"home",label:"Home",type:"application"},{icon:{library:"@ant-design/icons-svg",selector:"ContactsOutlined"},id:"about",label:"About",type:"application"},{icon:{library:"@fortawesome/free-solid-svg-icons",selector:"faHashtag"},id:"hash",label:"Hash",type:"application"},{icon:{library:"@fortawesome/free-brands-svg-icons",selector:"faReact"},id:"browser",label:"Browser",type:"application"},{icon:{library:"@fortawesome/free-brands-svg-icons",selector:"faAngular"},id:"angular",label:"Angular",type:"application"},{icon:{library:"@fortawesome/free-solid-svg-icons",selector:"faBox"},id:"custom",label:"Custom",type:"application"}]}},sources:["https://cdn.jsdelivr.net/npm/@micro-lc/bk-web-components/dist/bk-web-components.esm.js"]}}}),(0,i.kt)("p",null,"Let's make it more complex. Say we have another ",(0,i.kt)("a",{parentName:"p",href:"https://cdn.mia-platform.eu/micro-lc/examples/0.1.3/static/parcels/react-memory-router/index.html"},"in-memory router application"),":\nif you navigate to the link you'll see that moving using links does not affect the tab url."),(0,i.kt)("p",null,"In our custom application we would love to draw a layout, using the compose features but then embedding the ",(0,i.kt)("inlineCode",{parentName:"p"},"custom-parcel")," and the\nin memory router application side-by-side."),(0,i.kt)("p",null,"Let's change the application"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  ...,\n  "applications": {\n    ...,\n    "custom": {\n      "integrationMode": "compose", \ud83d\udc48 new mode\n      "route": "/custom",\n      "config": {\n        "content": {\n          "tag": "div",\n          "content": [\n            {\n              ... \ud83d\udc48 custom-parcel goes here\n            },\n            {\n              ... \ud83d\udc48 and in-memory router application goes here\n            }\n          ]\n        }\n      }\n    }\n  }\n}\n')),(0,i.kt)("p",null,"We would love to have the mounting factory provided by ",(0,i.kt)("micro-lc",null)," inside this context. The ",(0,i.kt)("inlineCode",{parentName:"p"},"microfrontend-loader"),"\nwebcomponent is made for this task."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  ...,\n  "applications": {\n    ...,\n    "custom": {\n      "integrationMode": "compose", \ud83d\udc48 new mode\n      "route": "/custom",\n      "config": {\n        "sources": [\n          "https://cdn.jsdelivr.net/npm/@micro-lc/orchestrator/dist/microfrontend-loader.js" \ud83d\udc48 add resources for \'microfrontend-loader\'\n        ],\n        "content": {\n          "tag": "div",\n          "content": [\n            {\n              "tag": "microfrontend-loader",\n              "properties": {\n                "application": {\n                  "integrationMode": "parcel",\n                  "entry": {\n                    "scripts": [\n                      "\ud83d\udcc4 paste base64 code here"\n                    ]\n                  }\n                }\n              }\n            },\n            {\n              "tag": "microfrontend-loader",\n              "properties": {\n                "application": {\n                  "integrationMode": "parcel",\n                  "entry": "https://cdn.mia-platform.eu/micro-lc/examples/0.1.3/static/parcels/react-memory-router/index.html"\n                }\n              }\n            }\n          ]\n        }\n      }\n    }\n  }\n}\n')),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"microfrontend-loader")," takes a unique property ",(0,i.kt)("inlineCode",{parentName:"p"},"application")," which is exactly the same object of any ",(0,i.kt)("micro-lc",null)," application but\nwithout a ",(0,i.kt)("inlineCode",{parentName:"p"},"route")," since in this context it does not make any sense."),(0,i.kt)("p",null,"Let's fix some style"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "sources": [...],\n  "content": {\n    "tag": "div",\n    "attributes": {\n      "style": "display: flex; justify-content: space-around; height: inherit;"\n    },\n    "content": [\n      {\n        "tag": "microfrontend-loader",\n        "attributes": {\n          "style": "width: 25%;"\n        },\n        "properties": {\n          "application": {\n            "integrationMode": "parcel",\n            "entry": {\n              "scripts": [\n                "\ud83d\udcc4 paste base64 code here"\n              ]\n            }\n          }\n        }\n      },\n      {\n        "tag": "microfrontend-loader",\n        "attributes": {\n          "style": "flex-grow: 1;"\n        },\n        "properties": {\n          "application": {\n            "integrationMode": "parcel",\n            "entry": "https://cdn.mia-platform.eu/micro-lc/examples/0.1.3/static/parcels/react-memory-router/index.html"\n          }\n        }\n      }\n    ]\n  }\n}\n')),(0,i.kt)(r.Fragment,null),(0,i.kt)("tutorial-frame",{configuration:{version:2,applications:{home:{integrationMode:"compose",route:"/",config:{content:{tag:"div",attributes:{style:"height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; row-gap: 24px; font-family: Arial;"},content:[{tag:"img",attributes:{alt:"logo",src:"https://cdn.mia-platform.eu/micro-lc/orchestrator/2.2.0/dist/favicon.png"}},{tag:"bk-button",properties:{content:"Go to official documentation",action:{type:"href",config:{href:"https://micro-lc.io/",target:"_blank"}}}}]},sources:["https://cdn.jsdelivr.net/npm/@micro-lc/bk-web-components/dist/bk-web-components.esm.js"]}},about:{integrationMode:"iframe",route:"/about",src:"https://example.com/"},hash:{integrationMode:"parcel",route:"/hash/",entry:"https://cdn.mia-platform.eu/micro-lc/examples/0.1.3/static/parcels/react-hash-router/index.html"},browser:{integrationMode:"parcel",route:"/browser/",injectBase:!0,entry:"https://cdn.mia-platform.eu/micro-lc/examples/0.1.3/static/parcels/react-browser-router/index.html"},angular:{integrationMode:"parcel",route:"/angular/",injectBase:"override",entry:"https://cdn.mia-platform.eu/micro-lc/examples/0.1.3/static/parcels/angular13/index.html"},custom:{integrationMode:"compose",route:"/custom",config:{sources:["https://cdn.jsdelivr.net/npm/@micro-lc/orchestrator/dist/microfrontend-loader.js"],content:{tag:"div",attributes:{style:"display: flex; justify-content: space-around;"},content:[{tag:"microfrontend-loader",attributes:{style:"width: 25%;"},properties:{application:{integrationMode:"parcel",entry:{scripts:["data:text/javascript;base64,InVzZSBzdHJpY3QiOygoKT0+e2xldCB0PW51bGw7Y29uc3QgZT17fTt3aW5kb3dbImN1c3RvbS1wYXJjZWwiXT1lO2NvbnN0IGw9YXN5bmMoKT0+bnVsbCxpPWFzeW5jIG49Pnt0PW4uY29udGFpbmVyLGNvbnNvbGUubG9nKG4ubWljcm9sY0FwaSk7Y29uc3Qgbz13aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksYz13aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7cmV0dXJuIE9iamVjdC5hc3NpZ24oby5zdHlsZSx7YWxpZ25JdGVtczoiY2VudGVyIixkaXNwbGF5OiJmbGV4IixmbGV4RGlyZWN0aW9uOiJjb2x1bW4iLGhlaWdodDoiMTAwJSIsanVzdGlmeUNvbnRlbnQ6ImNlbnRlciIsdGV4dEFsaWduOiJjZW50ZXIifSksYy50ZXh0Q29udGVudD0iQ2xpY2sgTWUhIixvLmFwcGVuZENoaWxkKGMpLG4uY29udGFpbmVyLmFwcGVuZENoaWxkKG8pLG51bGx9LHU9YXN5bmMoKT0+KHQhPT1udWxsJiZ0LmNoaWxkTm9kZXMuZm9yRWFjaChuPT5uLnJlbW92ZSgpKSx0PW51bGwpO2UuYm9vdHN0cmFwPWwsZS5tb3VudD1pLGUudW5tb3VudD11fSkoKTsK"]}}}},{tag:"microfrontend-loader",attributes:{style:"flex-grow: 1;"},properties:{application:{integrationMode:"parcel",entry:"https://cdn.mia-platform.eu/micro-lc/examples/0.1.3/static/parcels/react-memory-router/index.html"}}}]}}}},layout:{content:{tag:"bk-layout",properties:{logo:{url:"https://avatars.githubusercontent.com/u/92730708?s=200&v=4"},menuItems:[{icon:{library:"@ant-design/icons-svg",selector:"HomeOutlined"},id:"home",label:"Home",type:"application"},{icon:{library:"@ant-design/icons-svg",selector:"ContactsOutlined"},id:"about",label:"About",type:"application"},{icon:{library:"@fortawesome/free-solid-svg-icons",selector:"faHashtag"},id:"hash",label:"Hash",type:"application"},{icon:{library:"@fortawesome/free-brands-svg-icons",selector:"faReact"},id:"browser",label:"Browser",type:"application"},{icon:{library:"@fortawesome/free-brands-svg-icons",selector:"faAngular"},id:"angular",label:"Angular",type:"application"},{icon:{library:"@fortawesome/free-solid-svg-icons",selector:"faBox"},id:"custom",label:"Custom",type:"application"}]}},sources:["https://cdn.jsdelivr.net/npm/@micro-lc/bk-web-components/dist/bk-web-components.esm.js"]}}}))}g.isMDXComponent=!0}}]);